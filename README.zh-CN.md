<p align="center">
  <img src="https://img.shields.io/github/stars/LeoLin990405/ai-router-ccb?style=social" alt="Stars">
  <img src="https://img.shields.io/github/license/LeoLin990405/ai-router-ccb?color=blue" alt="License">
  <img src="https://img.shields.io/badge/Python-3.9+-3776AB?logo=python&logoColor=white" alt="Python">
  <img src="https://img.shields.io/badge/FastAPI-009688?logo=fastapi&logoColor=white" alt="FastAPI">
</p>

<h1 align="center">
  <br>
  ğŸ¤–
  <br>
  CCB Gateway
  <br>
</h1>

<h4 align="center">ä¼ä¸šçº§å¤š AI ç¼–æ’å¹³å°</h4>

<p align="center">
  <em>Claude ä½œä¸ºä¸»è„‘ï¼Œé€šè¿‡ç»Ÿä¸€ Gateway API è°ƒåº¦ 7 ä¸ª AI Providerï¼Œæ”¯æŒå®æ—¶ç›‘æ§</em>
</p>

<p align="center">
  <a href="#-ç‰¹æ€§">ç‰¹æ€§</a> â€¢
  <a href="#-å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a> â€¢
  <a href="#-web-ui">Web UI</a> â€¢
  <a href="#-api-å‚è€ƒ">API</a> â€¢
  <a href="#-æ¶æ„">æ¶æ„</a> â€¢
  <a href="#-å®‰è£…">å®‰è£…</a>
</p>

<p align="center">
  <a href="README.md">English</a> | <strong>ç®€ä½“ä¸­æ–‡</strong>
</p>

<p align="center">
  <img src="screenshots/dashboard.png" alt="CCB Gateway ä»ªè¡¨ç›˜" width="800">
</p>

---

## æ¦‚è¿°

**CCB Gateway** æ˜¯ä¸€ä¸ªç”Ÿäº§çº§å¤š AI ç¼–æ’å¹³å°ï¼Œ**Claude ä½œä¸ºä¸»è„‘ï¼ˆOrchestratorï¼‰**ï¼Œé€šè¿‡ç»Ÿä¸€çš„ Gateway API æ™ºèƒ½è°ƒåº¦ 7 ä¸ª AI Providerã€‚

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Claude (ä¸»è„‘)           â”‚
                    â”‚      Claude Code CLI        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      CCB Gateway API        â”‚
                    â”‚    http://localhost:8765    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼           â–¼           â–¼           â–¼           â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Kimi   â”‚ â”‚  Qwen   â”‚ â”‚DeepSeek â”‚ â”‚  Codex  â”‚ â”‚ Gemini  â”‚
     â”‚  ğŸš€ 7s  â”‚ â”‚  ğŸš€ 12s â”‚ â”‚  âš¡ 16s â”‚ â”‚ ğŸ¢ 48s  â”‚ â”‚ ğŸ¢ 71s  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  iFlow  â”‚ â”‚OpenCode â”‚
                      â”‚  âš¡ 25s â”‚ â”‚  âš¡ 42s â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸ºä»€ä¹ˆé€‰æ‹© CCB Gatewayï¼Ÿ

| æŒ‘æˆ˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| å¤šä¸ª AI CLI æ¥å£ä¸ç»Ÿä¸€ | **ç»Ÿä¸€ Gateway API**ï¼Œæ‰€æœ‰ Provider ä¸€è‡´ |
| æ‰‹åŠ¨é€‰æ‹© Provider | **æ™ºèƒ½è·¯ç”±**ï¼ŒåŸºäºé€Ÿåº¦åˆ†çº§è‡ªåŠ¨é™çº§ |
| æ— æ³•è§‚å¯Ÿ AI æ“ä½œ | **å®æ—¶ç›‘æ§**ï¼ŒWebSocket + Web UI |
| æ— ç¼“å­˜æˆ–é‡è¯•é€»è¾‘ | **å†…ç½®ç¼“å­˜ã€é‡è¯•å’Œé™çº§é“¾** |
| çœ‹ä¸åˆ° AI æ€è€ƒè¿‡ç¨‹ | **æ€è€ƒé“¾ & åŸå§‹è¾“å‡ºæ•è·** |
| Gemini OAuth ä»¤ç‰Œè¿‡æœŸ | **è‡ªåŠ¨åˆ·æ–°ä»¤ç‰Œ** - æ— éœ€æ‰‹åŠ¨é‡æ–°è®¤è¯ |

---

## âœ¨ ç‰¹æ€§

### æ ¸å¿ƒç½‘å…³

- **REST API** - `POST /api/ask`, `GET /api/reply/{id}`, `GET /api/status`
- **WebSocket** - å®æ—¶äº‹ä»¶æ¨é€ `/api/ws`
- **ä¼˜å…ˆçº§é˜Ÿåˆ—** - SQLite æŒä¹…åŒ–çš„è¯·æ±‚ä¼˜å…ˆçº§é˜Ÿåˆ—
- **å¤šåç«¯** - HTTP APIã€CLI æ‰§è¡Œã€WezTerm é›†æˆ
- **å¥åº·ç›‘æ§** - è‡ªåŠ¨ Provider å¥åº·æ£€æŸ¥

### ç”Ÿäº§çº§åŠŸèƒ½

- **API è®¤è¯** - åŸºäº API Key çš„è®¤è¯ï¼ŒSHA-256 å“ˆå¸Œ
- **é™æµ** - ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œæ”¯æŒæŒ‰ Key é™æµ
- **å“åº”ç¼“å­˜** - SQLite ç¼“å­˜ï¼Œæ”¯æŒ TTL å’Œæ¨¡å¼æ’é™¤
- **é‡è¯•ä¸é™çº§** - æŒ‡æ•°é€€é¿ï¼Œè‡ªåŠ¨ Provider é™çº§
- **å¹¶è¡ŒæŸ¥è¯¢** - åŒæ—¶æŸ¥è¯¢å¤šä¸ª Provider
- **Prometheus æŒ‡æ ‡** - `/metrics` ç«¯ç‚¹ç”¨äºç›‘æ§
- **æµå¼å“åº”** - Server-Sent Events å®æ—¶å“åº”

### CLI ç›‘æ§

- **æ€è€ƒé“¾æ•è·** - ä» `<thinking>` æ ‡ç­¾ã€`[Thinking]` å—ä¸­æå–æ¨ç†è¿‡ç¨‹
- **åŸå§‹è¾“å‡ºå­˜å‚¨** - å®Œæ•´ CLI è¾“å‡ºä¿å­˜ç”¨äºè°ƒè¯•
- **JSONL è§£æ** - Codex/OpenCode ç»“æ„åŒ–è¾“å‡ºæå–
- **Web UI å±•ç¤º** - è¯·æ±‚è¯¦æƒ…ä¸­å¯æŠ˜å çš„æ€è€ƒé“¾å’ŒåŸå§‹è¾“å‡º

### Provider é€Ÿåº¦åˆ†çº§ï¼ˆæ–°åŠŸèƒ½ï¼‰

| åˆ†çº§ | Providers | å“åº”æ—¶é—´ | é€‚ç”¨åœºæ™¯ |
|------|-----------|----------|----------|
| ğŸš€ **å¿«é€Ÿ** | Kimi, Qwen | 5-15 ç§’ | å¿«é€Ÿä»»åŠ¡ã€ç®€å•é—®é¢˜ |
| âš¡ **ä¸­é€Ÿ** | DeepSeek, iFlow, OpenCode | 15-60 ç§’ | å¤æ‚æ¨ç†ã€ç¼–ç¨‹ |
| ğŸ¢ **æ…¢é€Ÿ** | Codex, Gemini | 60-120 ç§’ | æ·±åº¦åˆ†æã€ä»£ç å®¡æŸ¥ |

### Gemini OAuth è‡ªåŠ¨åˆ·æ–°ï¼ˆæ–°åŠŸèƒ½ï¼‰

- **è‡ªåŠ¨åˆ·æ–°ä»¤ç‰Œ** - æ— éœ€æ‰‹åŠ¨é‡æ–°è®¤è¯
- **æ— ç¼é›†æˆ** - æ¯æ¬¡è¯·æ±‚å‰è‡ªåŠ¨æ£€æŸ¥å¹¶åˆ·æ–°è¿‡æœŸä»¤ç‰Œ
- **Gemini ä¼šå‘˜æ”¯æŒ** - Google One AI Premium ä¼šå‘˜å…è´¹ä½¿ç”¨

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¯åŠ¨ç½‘å…³

```bash
# å¯åŠ¨ç½‘å…³æœåŠ¡å™¨
cd ~/.local/share/codex-dual
python3 -m lib.gateway.gateway_server --port 8765

# æˆ–ä½¿ç”¨é…ç½®æ–‡ä»¶
python3 -m lib.gateway.gateway_server --config ~/.ccb_config/gateway.yaml
```

### å‘é€è¯·æ±‚

```bash
# å‘å¿«é€Ÿ Provider æäº¤è¯·æ±‚
curl -X POST http://localhost:8765/api/ask \
  -H "Content-Type: application/json" \
  -d '{"provider": "kimi", "message": "ä½ å¥½"}'

# è·å–å“åº”
curl "http://localhost:8765/api/reply/{request_id}"

# å¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰ Provider
curl -X POST http://localhost:8765/api/ask \
  -H "Content-Type: application/json" \
  -d '{"provider": "@all", "message": "2+2ç­‰äºå¤šå°‘ï¼Ÿ", "aggregation_strategy": "first_success"}'

# åªæŸ¥è¯¢å¿«é€Ÿ Provider
curl -X POST http://localhost:8765/api/ask \
  -H "Content-Type: application/json" \
  -d '{"provider": "@fast", "message": "å¿«é€Ÿé—®é¢˜"}'
```

### æ£€æŸ¥çŠ¶æ€

```bash
# ç½‘å…³çŠ¶æ€ï¼ˆåŒ…å« Provider å»¶è¿Ÿï¼‰
curl http://localhost:8765/api/status

# Prometheus æŒ‡æ ‡
curl http://localhost:8765/metrics
```

---

## ğŸ–¥ï¸ Web UI

å¯åŠ¨ç½‘å…³åè®¿é—® `http://localhost:8765/` æ‰“å¼€ Web UIã€‚

<p align="center">
  <img src="screenshots/dashboard.png" alt="ä»ªè¡¨ç›˜" width="800">
  <br>
  <em>ä»ªè¡¨ç›˜ - å®æ—¶ç½‘å…³ç»Ÿè®¡å’Œ Provider çŠ¶æ€</em>
</p>

### ä»ªè¡¨ç›˜
- å®æ—¶ç½‘å…³ç»Ÿè®¡å’Œ Provider çŠ¶æ€
- è¯·æ±‚æ—¶é—´çº¿å¯è§†åŒ–
- WebSocket å®æ—¶æ´»åŠ¨æ—¥å¿—
- **Provider é€Ÿåº¦æŒ‡ç¤ºå™¨**ï¼ˆğŸš€/âš¡/ğŸ¢ï¼‰

### å®æ—¶ç›‘æ§ï¼ˆæ–°åŠŸèƒ½ï¼‰
- **å®æ—¶ AI è¾“å‡º** - å®æ—¶æŸ¥çœ‹ AI å“åº”æµ
- **ç½‘æ ¼è§†å›¾** - åŒæ—¶ç›‘æ§æ‰€æœ‰ Provider
- **èšç„¦è§†å›¾** - å…¨å±æŸ¥çœ‹å•ä¸ª Provider è¾“å‡º
- **æ´»è·ƒè¯·æ±‚å¡ç‰‡** - æ˜¾ç¤ºå¤„ç†ä¸­è¯·æ±‚çš„è¿›åº¦æ¡
- **é¢œè‰²ç¼–ç è¾“å‡º** - ä¿¡æ¯ï¼ˆé’è‰²ï¼‰ã€é”™è¯¯ï¼ˆçº¢è‰²ï¼‰ã€æˆåŠŸï¼ˆç»¿è‰²ï¼‰ã€æ€è€ƒï¼ˆæ©™è‰²ï¼‰
- **è‡ªåŠ¨æ»šåŠ¨** - è‡ªåŠ¨è·Ÿéšæœ€æ–°è¾“å‡º

### è¯·æ±‚ç®¡ç†
- å¯é…ç½®é¡µé¢å¤§å°çš„åˆ†é¡µ
- æŒ‰ Providerã€çŠ¶æ€ã€å†…å®¹æœç´¢å’Œè¿‡æ»¤
- ä¸€é”®é‡è¯•å¤±è´¥è¯·æ±‚
- **æŸ¥çœ‹æ¯ä¸ªè¯·æ±‚çš„æ€è€ƒé“¾å’ŒåŸå§‹è¾“å‡º**

### æµ‹è¯•æ§åˆ¶å°
- äº¤äº’å¼ API æµ‹è¯•
- Provider é€‰æ‹©ï¼Œæ”¯æŒè‡ªåŠ¨è·¯ç”±
- æµå¼å“åº”å¼€å…³

### å¯¹æ¯”æ¨¡å¼
- å¹¶æ’ Provider å¯¹æ¯”
- åŒæ—¶æŸ¥è¯¢å¤šä¸ª Provider

### åŠŸèƒ½ç‰¹æ€§
- **æ·±è‰²/æµ…è‰²ä¸»é¢˜** - åˆ‡æ¢å¹¶æŒä¹…åŒ–åˆ° localStorage
- **å›½é™…åŒ–æ”¯æŒ** - ä¸­è‹±æ–‡åŒè¯­
- **é”®ç›˜å¿«æ·é”®** - `1-7` åˆ‡æ¢æ ‡ç­¾é¡µï¼Œ`R` åˆ·æ–°ï¼Œ`T` æµ‹è¯•ï¼Œ`?` å¸®åŠ©
- **ç¡®è®¤å¯¹è¯æ¡†** - é˜²æ­¢è¯¯åˆ é™¤
- **å¤åˆ¶åˆ°å‰ªè´´æ¿** - ä¸€é”®å¤åˆ¶ API Key

---

## ğŸ“¡ API å‚è€ƒ

### ç«¯ç‚¹

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| `POST` | `/api/ask` | å‘ Provider æäº¤è¯·æ±‚ |
| `GET` | `/api/reply/{id}` | è·å–å“åº” |
| `GET` | `/api/status` | ç½‘å…³å’Œ Provider çŠ¶æ€ |
| `GET` | `/api/requests` | åˆ—å‡ºæœ€è¿‘è¯·æ±‚ï¼ˆæ”¯æŒåˆ†é¡µï¼‰ |
| `DELETE` | `/api/request/{id}` | å–æ¶ˆå¾…å¤„ç†è¯·æ±‚ |
| `GET` | `/api/health` | å¥åº·æ£€æŸ¥ |
| `GET` | `/api/cache/stats` | ç¼“å­˜ç»Ÿè®¡ |
| `DELETE` | `/api/cache` | æ¸…é™¤ç¼“å­˜ |
| `GET` | `/metrics` | Prometheus æŒ‡æ ‡ |
| `GET` | `/docs` | äº¤äº’å¼ API æ–‡æ¡£ |

### è¯·æ±‚ä½“

```json
{
  "provider": "kimi",
  "message": "ä½ çš„é—®é¢˜",
  "timeout_s": 120,
  "priority": 50,
  "cache_bypass": false,
  "aggregation_strategy": null
}
```

### Provider åˆ†ç»„

| åˆ†ç»„ | Providers | ä½¿ç”¨åœºæ™¯ |
|------|-----------|----------|
| `@all` | å…¨éƒ¨ 7 ä¸ª | å…¨é¢å¯¹æ¯” |
| `@fast` | Kimi, Qwen | å¿«é€Ÿå“åº” |
| `@chinese` | Kimi, Qwen, DeepSeek | ä¸­æ–‡ä»»åŠ¡ |
| `@coding` | Codex, OpenCode, Kimi | ä»£ç ç”Ÿæˆ |

### å“åº”ï¼ˆåŒ…å« thinking/raw_outputï¼‰

```json
{
  "request_id": "abc123-def",
  "status": "completed",
  "response": "ç­”æ¡ˆæ˜¯...",
  "thinking": "<æå–çš„æ€è€ƒé“¾ï¼ˆå¦‚æœ‰ï¼‰>",
  "raw_output": "<å®Œæ•´ CLI è¾“å‡ºç”¨äºè°ƒè¯•>",
  "latency_ms": 1234.56,
  "cached": false
}
```

### API è®¤è¯

```bash
# åˆ›å»º API Key
curl -X POST http://localhost:8765/api/admin/keys \
  -H "Content-Type: application/json" \
  -d '{"name": "my-app", "rate_limit_rpm": 100}'

# ä½¿ç”¨ API Key
curl -X POST http://localhost:8765/api/ask \
  -H "X-API-Key: your-api-key" \
  -H "Content-Type: application/json" \
  -d '{"provider": "kimi", "message": "ä½ å¥½"}'
```

---

## ğŸ—ï¸ æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CCB Gateway æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                 Claude (ä¸»è„‘ / Orchestrator)                   â”‚ â”‚
â”‚  â”‚                  æ™ºèƒ½ä»»åŠ¡è°ƒåº¦ä¸åè°ƒ                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Gateway API å±‚                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚REST API â”‚ â”‚WebSocketâ”‚ â”‚  è®¤è¯   â”‚ â”‚  é™æµ   â”‚ â”‚  æŒ‡æ ‡   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚(FastAPI)â”‚ â”‚ (äº‹ä»¶)  â”‚ â”‚(API Key)â”‚ â”‚(ä»¤ç‰Œæ¡¶) â”‚ â”‚(Prometh)â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        å¤„ç†å±‚                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  ç¼“å­˜   â”‚ â”‚  é‡è¯•   â”‚ â”‚  å¹¶è¡Œ   â”‚ â”‚  æµå¼   â”‚ â”‚ æ€è€ƒé“¾  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚(SQLite) â”‚ â”‚ (é™çº§)  â”‚ â”‚(å¤šAI)   â”‚ â”‚ (SSE)   â”‚ â”‚  æå–   â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Provider å±‚ (7 ä¸ª Providerï¼Œ3 ä¸ªåˆ†çº§)             â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  ğŸš€ å¿«é€Ÿ (5-15s)    âš¡ ä¸­é€Ÿ (15-60s)    ğŸ¢ æ…¢é€Ÿ (60-120s)     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Kimi â”‚ â”‚ Qwen â”‚  â”‚DeepSeekâ”‚ â”‚ iFlow â”‚  â”‚ Codex â”‚ â”‚Gemini â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚ â”‚
â”‚  â”‚                     â”‚OpenCodeâ”‚                                 â”‚ â”‚
â”‚  â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Provider çŸ©é˜µ

| Provider | åˆ†çº§ | å¹³å‡å»¶è¿Ÿ | æœ€ä½³ç”¨é€” |
|----------|------|----------|----------|
| **Kimi** | ğŸš€ å¿«é€Ÿ | ~7s | ä¸­æ–‡ã€é•¿ä¸Šä¸‹æ–‡ |
| **Qwen** | ğŸš€ å¿«é€Ÿ | ~12s | å¤šè¯­è¨€ã€é€šç”¨ |
| **DeepSeek** | âš¡ ä¸­é€Ÿ | ~16s | æ·±åº¦æ¨ç† |
| **iFlow** | âš¡ ä¸­é€Ÿ | ~25s | å·¥ä½œæµè‡ªåŠ¨åŒ– |
| **OpenCode** | âš¡ ä¸­é€Ÿ | ~42s | é€šç”¨ç¼–ç¨‹ |
| **Codex** | ğŸ¢ æ…¢é€Ÿ | ~48s | ä»£ç ç”Ÿæˆ |
| **Gemini** | ğŸ¢ æ…¢é€Ÿ | ~71s | å‰ç«¯ã€ä»£ç å®¡æŸ¥ |

### é™çº§é“¾

```yaml
fallback_chains:
  kimi: ["qwen", "deepseek"]
  qwen: ["kimi", "deepseek"]
  deepseek: ["kimi", "qwen"]
  gemini: ["kimi", "qwen"]
  codex: ["kimi", "qwen"]
```

> **æ³¨æ„**: Claude æ˜¯ä¸»è„‘ï¼Œä¸å‚ä¸ä»»åŠ¡è°ƒåº¦ã€‚

---

## ğŸ“¦ å®‰è£…

### å‰ç½®æ¡ä»¶

- **Python 3.9+**
- **WezTerm**ï¼ˆæ¨èï¼‰æˆ– tmux
- å·²å®‰è£… Provider CLI: `codex`, `gemini`, `opencode`, `deepseek`, `kimi`, `qwen`, `iflow`

### å®‰è£…æ­¥éª¤

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/LeoLin990405/ai-router-ccb.git ~/.local/share/codex-dual

# å®‰è£…ä¾èµ–
pip install fastapi uvicorn pyyaml aiohttp prometheus-client

# å¯åŠ¨ç½‘å…³
cd ~/.local/share/codex-dual
python3 -m lib.gateway.gateway_server --port 8765

# æ‰“å¼€ Web UI
open http://localhost:8765/
```

### é…ç½®

```yaml
# ~/.ccb_config/gateway.yaml
server:
  host: "127.0.0.1"
  port: 8765

default_provider: "kimi"  # é»˜è®¤ä½¿ç”¨å¿«é€Ÿ Provider

providers:
  kimi:
    enabled: true
    backend_type: "cli_exec"
    cli_command: "kimi"
    cli_args: ["--quiet", "-p"]
    timeout_s: 120
    priority: 90  # å¿«é€Ÿ Provider é«˜ä¼˜å…ˆçº§

  gemini:
    enabled: true
    backend_type: "cli_exec"
    cli_command: "gemini"
    cli_args: ["-p"]  # éäº¤äº’å¼æç¤ºæ¨¡å¼
    timeout_s: 120

retry:
  enabled: true
  max_retries: 2
  fallback_enabled: true
  fallback_chains:
    gemini: ["kimi", "qwen"]
```

### Gemini è®¾ç½®ï¼ˆOAuthï¼‰

é€‚ç”¨äº Google One AI Premium / Gemini ä¼šå‘˜ï¼š

```bash
# é¦–æ¬¡è®¤è¯ï¼ˆåªéœ€ä¸€æ¬¡ï¼‰
gemini

# å†…ç½®è‡ªåŠ¨åˆ·æ–°ä»¤ç‰Œ - æ— éœ€æ‰‹åŠ¨é‡æ–°è®¤è¯ï¼
```

---

## ğŸ”„ æœ€è¿‘æ›´æ–°

### v0.10.x - å®æ—¶ç›‘æ§ï¼ˆæœ€æ–°ï¼‰
- **å®æ—¶ AI ç›‘æ§** - å®æ—¶æŸ¥çœ‹ AI è¾“å‡ºæµ
- **ç½‘æ ¼/èšç„¦è§†å›¾** - å¤š Provider æˆ–å• Provider ç›‘æ§
- **æ´»è·ƒè¯·æ±‚è¿½è¸ª** - å¤„ç†ä¸­è¯·æ±‚çš„è¿›åº¦æ¡
- **é¢œè‰²ç¼–ç è¾“å‡º** - ä¿¡æ¯/é”™è¯¯/æˆåŠŸ/æ€è€ƒçš„è§†è§‰åŒºåˆ†
- **WebSocket é›†æˆ** - å®æ—¶ stream_chunk å’Œ thinking äº‹ä»¶

### v0.9.x - Provider ä¼˜åŒ–
- **Provider é€Ÿåº¦åˆ†çº§** - å¿«é€Ÿ/ä¸­é€Ÿ/æ…¢é€Ÿåˆ†ç±»
- **Gemini OAuth è‡ªåŠ¨åˆ·æ–°** - æ— ç¼ä»¤ç‰Œç®¡ç†
- **æ”¹è¿›é™çº§é“¾** - åŸºäºé€Ÿåº¦çš„æ™ºèƒ½é™çº§
- **Provider åˆ†ç»„** - `@fast`ã€`@chinese`ã€`@coding`
- **è¶…æ—¶ä¼˜åŒ–** - æ›´å¿«çš„å“åº”

### v0.8.x - CLI ç›‘æ§
- **æ€è€ƒé“¾æ•è·** - æå–å¹¶å±•ç¤º AI æ¨ç†è¿‡ç¨‹
- **åŸå§‹è¾“å‡ºå­˜å‚¨** - å®Œæ•´ CLI è¾“å‡ºä¿å­˜åˆ°æ•°æ®åº“
- **æ”¹è¿›è¾“å‡ºæ¸…ç†** - æ›´å¥½çš„ Gemini æ ¼å¼ JSON æå–
- **Web UI å¢å¼º** - å¯æŠ˜å çš„æ€è€ƒé“¾/åŸå§‹è¾“å‡ºå±•ç¤º

### v0.7.x - ç”Ÿäº§çº§åŠŸèƒ½
- API è®¤è¯ä¸é™æµ
- å“åº”ç¼“å­˜ä¸ TTL
- é‡è¯•ä¸é™çº§æœºåˆ¶
- Prometheus æŒ‡æ ‡é›†æˆ

---

## ğŸ™ è‡´è°¢

- **[bfly123/claude_code_bridge](https://github.com/bfly123/claude_code_bridge)** - åŸå§‹å¤š AI åä½œæ¡†æ¶
- **[Grafbase/Nexus](https://github.com/grafbase/nexus)** - AI ç½‘å…³æ¶æ„çµæ„Ÿ

---

## ğŸ‘¥ è´¡çŒ®è€…

- **Leo** ([@LeoLin990405](https://github.com/LeoLin990405)) - é¡¹ç›®è´Ÿè´£äºº
- **Claude** (Anthropic Claude Opus 4.5) - æ¶æ„ä¸å®ç°

---

## ğŸ“„ è®¸å¯è¯

MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE)

---

<p align="center">
  <sub>äººæœºåä½œå…±åŒæ„å»º</sub>
  <br>
  <sub>â­ å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œè¯·ç»™ä¸ª Starï¼</sub>
</p>
